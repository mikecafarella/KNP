<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Knowledge Client - Knowledge Graph Programming Language</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../css/custom.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Knowledge Client";
    var mkdocs_page_input_path = "knowledgeclient.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Knowledge Graph Programming Language</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Welcome</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../tutorial/">Tutorial</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../sharingservice/">Sharing Service</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Knowledge Client</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#data-model">Data Model</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#execution-model">Execution Model</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#basic-usages">Basic Usages</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#tutorial-1-basic-dataset-construction-with-the-presidents">Tutorial 1: Basic dataset construction with the presidents</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#tutorial-2-adding-numerical-data-from-the-european-union">Tutorial 2: Adding numerical data from the European Union</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#tutorial-3-whole-table-functions-with-national-parks-data">Tutorial 3: Whole-table functions with National Parks data</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#reminder">REMINDER:</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../lineage/">Lineage</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../restapi/">REST API</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../install/">Installation</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../api/">API Documentation</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Knowledge Graph Programming Language</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Knowledge Client</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="the-knowledge-client">The Knowledge Client</h1>
<p>This document describes the <strong>Knowledge Client</strong>, and how to use it to build data-powered applications very quickly.</p>
<p>The main goal of the <strong>Knowledge Client</strong> is to allow users to quickly obtain a high-quality relation, on any topic.  It is intended for integration into applications or data science workflows.  The client obtains its data from the backing <a href="../sharingservice/"><strong>Universal Knowledge Collaboration Network</strong></a>.  Users may have to consult the <strong>UKCN</strong> in order to find the right identifiers for data objects and properties.</p>
<p>The current client is written in Python, though there is nothing    Python-specific about it: future clients could be written to integrate with programs in Go, Rust, Swift, etc.</p>
<h2 id="data-model">Data Model</h2>
<p>A relation in both the <strong>Knowledge Client</strong> and the <strong>UKCN</strong> is akin to a traditional RDBMS relation: it's got rows and columns.  However, our relations differ in two important ways:
1. Each row has a globally-unique identifier. This is roughly similar to the <em>rowid</em> that some database systems provide. However, our row ids are globally-unique identifiers.
2. Like a traditional RDBMS, each column has a human-understandable <em>name</em> (e.g., "Salary") and a <em>type</em> (e.g., "float"). In addition, in our system each column has a <em>semantic label</em>. These labels are drawn from a dictionary maintained by the <strong>UKCN</strong>. For example, a column might be annotated by a label <em>/properties/wikidata/P3618</em>, which indicates "base salary".</p>
<h2 id="execution-model">Execution Model</h2>
<p>The client allows the programmer to build a single relation at a time.
The sequence of steps that the <strong>Knowledge Client</strong> performs can be thought of as a single "table initialization step", followed by a series of joins that grow the table's rows and columns.  </p>
<p>Some common kinds of initialization include:
- Creating a table of a single row and a single column. For example, consider a single column that identifies a KG object, with a single row that represents the <em>Barack Obama</em> object.
- Creating a table of many rows and a single column. For example, consider a single column that identifies a KG object, with multiple rows that represent members of a class, such as all instances of the <em>City</em> object.
- Creating a table that corresponds to a pre-made table in the <strong>UKCN</strong>. For example, the programmer may grab a table of dollar-to-Euro exchange statistics.</p>
<p>After initialization, the user performs a series of joins that potentially add rows and columns to the table. With some naming guidance from the user, the system synthesizes all of the appropriate column metadata for each new row and column.</p>
<p>The system does not try to extract or clean <strong>UKCN</strong> data at the time of use, apart from a few important exceptions.  At the individual fact level, everything the user sees inside a relation created by the <strong>Knowledge Client</strong> can be found in the <strong>UKCN</strong>.</p>
<p>The exceptions surround cases when the system believes that facts in the <strong>UKCN</strong> are correct at the individual level, but will yield a relation that is internally inconsistent.  Unfortunately, this is a well-known problem in knowledge graphs. Consider the example that <em>Tim Berners-Lee</em> is an example of <em>Computer Scientist</em>, while <em>Computer Scientist</em> is an example of <em>profession</em>. A <strong>Knowledge Client</strong> user trying to create a table of professions might inadvertently obtain one that includes <em>Tim Berners-Lee</em>.  When appropriate, the <strong>Knowledge Client</strong> will either silently fix these issues, or will issue a warning to the user.</p>
<h2 id="basic-usages">Basic Usages</h2>
<p><strong>createRelation(entity_id: str, property_id=None, isSubject=None, rowVerbose=None, colVerbose=None,
                   time_property=None, time=None, name=None, label=False, limit=None, subclass=False)</strong></p>
<p>This function creates a Relation class object.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p>entity_id: str</p>
<p>the base Wikidata entity of the Relation (e.g., 'Q30')</p>
</li>
<li>
<p>Others:</p>
<p>The other parameters are the same as those in Relation.extend()</p>
</li>
</ul>
<p><strong>Relation.extend(self, property_id: str, isSubject: bool, name: str, rowVerbose=False, colVerbose=False, limit=None,
               time_property=None, time=None, search=None, label=False, subclass=False, showid=False)</strong></p>
<p>This function extends a column upon the current focus with a specified property.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p>property_id: str</p>
<p>the Wikidata property identifier (e.g., 'P31')</p>
</li>
<li>
<p>isSubject: bool</p>
<p>indicates whether the column to be extended is the subject in the (subject-&gt;property-&gt;object) triple. </p>
<p>(e.g., If the base entity is 'Q33999' (actor) and the property to extend upon is 'P106' (has occupation), isSubject should be True since we want to find who has an occupation as an actor.)</p>
</li>
<li>
<p>name: str</p>
<p>name of the extended column (use underscore for all spaces). The property identifier will be automatically appended in the final result. </p>
<p>(e.g., If specifying name='population' and property_id='P1082', the column in the dataframe will finally be called 'population_P1082'.)</p>
</li>
<li>
<p>rowVerbose: bool, default False</p>
<p>indicates whether all the results of the extended column should be displayed. If rowVerbose=False, it only returns the results with preferred rank.</p>
</li>
<li>
<p>colVerbose: bool, default False</p>
<p>indicates whether the qualifiers of the extended column and all the other metadata should be displayed. e.g., If colVerbose=True and property_id='P1082' (population), the time for each population value will be shown as another column, since 'P585' (point in time) is a qualifier associated with 'P1082'.</p>
</li>
<li>
<p>limit: int, default None</p>
<p>the max number of rows displayed</p>
</li>
<li>
<p>time_property: str, default None</p>
<p>the time qualifier constraint used to select the results. Used with parameter 'time'.</p>
</li>
<li>
<p>time: int, default None</p>
<p>specifies the year constraint applied to the qualifier (not property). Used with parameter 'time_property'. e.g., If property_id='P1082' (population), time_property='P585' and time=2010, it will only return the population in 2010.</p>
</li>
<li>
<p>search: str or pair, default None</p>
<p>specifies the constraint applied to the property (not qualifier). There are several methods:</p>
<ul>
<li>
<p>If the search key is search='!NA', it will eliminate the null values in that column.</p>
</li>
<li>
<p>If the search key is a Wikidata Entity (e.g., search='Q30'), it will select the rows whose results match.</p>
</li>
<li>
<p>If the search key is a tuple of 2 numerical values (e.g., search=(10, 20)), it will select the rows whose results are in this range (both ends included).</p>
</li>
<li>
<p>If the search key is a tuple of 2 strings representing years (e.g., search=('2010', '2020')), it will select the rows whose results are in this year range.</p>
</li>
</ul>
</li>
<li>
<p>label: bool, default False</p>
<p>indicates whether an extra column translating Wikidata entity identifiers to semantic labels (e.g., 'Q76' will be translated as Barack Obama).</p>
</li>
<li>
<p>subclass: bool, default False</p>
<p>indicates whether all instances of subclasses are needed. This applies specifically to 'P31'.</p>
</li>
<li>
<p>showid: bool, default False</p>
<p>indicates whether the Wikidata entity ID should display alone. If showid=True, 'www.wikidata.org/wiki/Q76' will be displayed as 'Q76' only.</p>
</li>
</ul>
<p><strong>Relation.query(self)</strong></p>
<p>This funtion executes the query built by Relation.extend() so far and returns a relation-like dataframe.</p>
<p><strong>Relation.extendWithFunction(self, objcolumn, func, name)</strong></p>
<p>This function adds a column to the relation, similar to what Relation.extend() does, but the column is filled with function outputs instead of information grabbed directly from knowledge graphs. ExtendWithFunction should be called only after Relation.query() has been called.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p>objcolumn: list</p>
<p>A list of the column names in the Relation that serve as the inputs of func.</p>
</li>
<li>
<p>func: str or function object:</p>
<p>The function whose outputs will fill the new column. It can be a string that starts with 'F' followed by a number (e.g, 'F10'), which means calling a function published in the function library.</p>
</li>
<li>
<p>name: str</p>
<p>The name of the newly added column.</p>
</li>
</ul>
<h2 id="examples">Examples</h2>
<p>Let's try to show a few examples of using the <strong>Knowledge Client</strong>.</p>
<h2 id="tutorial-1-basic-dataset-construction-with-the-presidents">Tutorial 1: Basic dataset construction with the presidents</h2>
<p><strong>Dinghao, Tian, Kexin: can we add a simple example here?  Just add basic entity data that's already in the knowledge graph.  Presidents, their spouses, and their places and dates of birth. That's it.</strong></p>
<p>Construct a relation of US presidents, their spouses, their dates of birth and places of births: </p>
<div class="codehilite"><pre><span></span><code><span class="err">r = createRelation(&#39;Q11696&#39;) # Q11696 - &#39;President of the United States&#39; in wikidata</span>
<span class="err">r.extend(&#39;P39&#39;,True, &#39;President&#39;, limit=20, label=True) # P39 - &#39;position held&#39;</span>
<span class="err">r.changeFocus(&#39;President_P39&#39;)</span>
<span class="err">r.extend(&#39;P26&#39;, False, &#39;Spouse&#39;, label=True) # P26 - &#39;spouse&#39;</span>
<span class="err">r.extend(&#39;P569&#39;, False, &#39;date_of_birth&#39;, label=True) # P569 - &#39;date of birth&#39;</span>
<span class="err">r.extend(&#39;P19&#39;,False, &#39;Place_of_birth&#39;, label=True) #P19 - &#39;place of birth&#39;</span>
<span class="err">r.query()</span>
<span class="err">r.df</span>
</code></pre></div>

<p><img width="969" alt="presidents1" src="https://user-images.githubusercontent.com/44870308/105150679-11503300-5ad3-11eb-8221-3b69af9cc58a.png">
<img width="732" alt="presidents2" src="https://user-images.githubusercontent.com/44870308/105154486-976e7880-5ad7-11eb-875b-e2f0859b2a7f.png"></p>
<h2 id="tutorial-2-adding-numerical-data-from-the-european-union">Tutorial 2: Adding numerical data from the European Union</h2>
<p><strong>Dinghao, Tian, Kexin: here let's add a bit more complicated stuff.  The European Union and GDP data.  Then let's do inflation-adjustment for the GDP data.</strong></p>
<p>Here is an example of all countries in the European Union and their population, as well as the population of the whole Europe:</p>
<div class="codehilite"><pre><span></span><code><span class="err">r = createRelation(&#39;Q458&#39;) # Q458 - &#39;European Union&#39; in wikidata</span>
<span class="err">r.extend(&#39;P150&#39;,False,&#39;Countries&#39;,label=True) # P150 - &#39;contains administrative territorial entity&#39;</span>
<span class="err">r.extend(&#39;P1082&#39;,False, &#39;Total_population&#39;) # P1082 - &#39;Population&#39;</span>
<span class="err">r.changeFocus(&#39;Countries_P150&#39;)</span>
<span class="err">r.extend(&#39;P1082&#39;,False, &#39;population&#39;)</span>
<span class="err">r.query()</span>
<span class="err">r.df</span>
</code></pre></div>

<p><img width="913" alt="EuroCountries" src="https://user-images.githubusercontent.com/44870308/105154661-c684ea00-5ad7-11eb-9bcb-6cb6380d72fe.png"></p>
<p>Here is another example of inflation-adjusted US GDP data, with the base year of 2014: </p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">math</span>
<span class="k">def</span> <span class="nf">adjustedGDP</span><span class="p">(</span><span class="n">gdp</span><span class="p">:</span> <span class="n">WikiDataProperty</span><span class="p">([</span><span class="s1">&#39;P2131&#39;</span><span class="p">,</span> <span class="s1">&#39;P2132&#39;</span><span class="p">]),</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">WikiDataProperty</span><span class="p">([</span><span class="s1">&#39;P585&#39;</span><span class="p">])):</span>
      <span class="n">inflationIndex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;inflation_data_found_online.csv&#39;</span><span class="p">)</span>
      <span class="n">base</span> <span class="o">=</span> <span class="n">inflationIndex</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Index&#39;</span><span class="p">]</span>
      <span class="n">timestamp</span> <span class="o">=</span> <span class="n">timestamp</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
      <span class="n">inflationIndex</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="n">inflationIndex</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">gdp</span><span class="p">)</span> <span class="o">/</span> <span class="n">inflationIndex</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">timestamp</span><span class="p">][</span><span class="s1">&#39;Index&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">base</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">gdp</span><span class="p">))</span>

<span class="n">usgdp</span> <span class="o">=</span> <span class="n">createRelation</span><span class="p">(</span><span class="s1">&#39;Q30&#39;</span><span class="p">)</span> <span class="c1"># Q30 - &#39;United States of America&#39;</span>
<span class="n">usgdp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s1">&#39;P2131&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="s1">&#39;GDP&#39;</span><span class="p">,</span> <span class="n">colVerbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">rowVerbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># P2131 - &#39;nominal GDP&#39;</span>
<span class="n">usgdp</span><span class="o">.</span><span class="n">query</span><span class="p">()</span>
<span class="n">usgdp</span><span class="o">.</span><span class="n">extendWithFunction</span><span class="p">([</span><span class="s1">&#39;GDP_P2131&#39;</span><span class="p">,</span><span class="s1">&#39;GDP_point_in_time_P2131_P585&#39;</span><span class="p">],</span> <span class="n">adjustedGDP</span><span class="p">,</span> <span class="s1">&#39;adjustedGDP_P2131&#39;</span><span class="p">)</span> <span class="c1"># base 2014</span>
<span class="n">usgdp</span><span class="o">.</span><span class="n">df</span>
</code></pre></div>

<p><img width="1010" alt="adjustedGDP1" src="https://user-images.githubusercontent.com/44870308/105154682-cab10780-5ad7-11eb-965c-93fad0baa02c.png">
<img width="1042" alt="adjustedGDP2" src="https://user-images.githubusercontent.com/44870308/105154701-cedd2500-5ad7-11eb-88ac-923423b538ce.png"></p>
<h2 id="tutorial-3-whole-table-functions-with-national-parks-data">Tutorial 3: Whole-table functions with National Parks data</h2>
<p><strong>Jenny, let's do the National Parks inception data here, and show how to do whole-table function invocation</strong>.</p>
<h2 id="reminder">REMINDER:</h2>
<p><strong>WE NEED TO FIGURE OUT THE DATA MODEL DISTINCTION BETWEEN USING WIKIDATA VS USING THE SHARING SERVICE.  RIGHT NOW THE CLIENT ONLY EXPLOITS WIKIDATA, BUT THIS SHOULD CHANGE VERY SOON.</strong></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../lineage/" class="btn btn-neutral float-right" title="Lineage">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../sharingservice/" class="btn btn-neutral" title="Sharing Service"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../sharingservice/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../lineage/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
